function geti(a){if(document.getElementById(a))return document.getElementById(a);console.warn(a,"not found")}userfield=geti("userfield");passfield=geti("passfield");loginbutton=geti("loginbutton");loginregscreen=geti("loginregpage");createaccbutton=geti("createaccbutton");gotologinbut=geti("gotologinbut");reguserfield=geti("reguserfield");regpassfield=geti("regpassfield");valregpassfield=geti("validationregpassfield");feed=geti("feed");
function httpusernameexist(a){xhttp=new XMLHttpRequest;xhttp.onreadystatechange=function(){4==this.readyState&&200==this.status&&(1==this.responseText?(reguserfield.classList.add("warn"),gotologinbut.classList.add("warn"),reguserfield.classList.remove("correct")):(gotologinbut.classList.remove("warn"),reguserfield.classList.remove("warn"),reguserfield.classList.add("correct")))};xhttp.open("POST","/usernameexist/",!0);xhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");xhttp.send("username="+
a)}
function httplogin(a,b){xhttp=new XMLHttpRequest;xhttp.onreadystatechange=function(){if(4==this.readyState&&200==this.status)switch(response=this.responseText,response){case "loginsuccesful":case "alreadyloggedon":loginregscreen.classList.add("loggedin");updatefeed();break;case "incorrectcredentials":passfield.classList.add("error");break;case "nopassuserset":userfield.classList.add("error");passfield.classList.add("error");break;case "usernamenotexist":createaccbutton.classList.add("warn");userfield.classList.add("warn");break;
default:console.warn("unknown error occured",response)}};xhttp.open("POST","/login/",!0);xhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");xhttp.send("username="+a+"&password="+b)}
function httplogout(){xhttp=new XMLHttpRequest;xhttp.onreadystatechange=function(){4==this.readyState&&200==this.status&&(loginregscreen.classList.remove("loggedin"),userfield.value="",passfield.value="",reguserfield.value="",regpassfield.value="",valregpassfield.value="",feed.innerHTML="")};xhttp.open("GET","/logout/",!0);xhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");xhttp.send()}
function httpreg(a,b){xhttp=new XMLHttpRequest;xhttp.onreadystatechange=function(){if(4==this.readyState&&200==this.status)switch(response=this.responseText,response){case "nopassuserset":case "unsafechar":reguserfield.classList.add("error");valregpassfield.classList.add("error");regpassfield.classList.add("error");break;case "accalreadyexist":reguserfield.classList.add("warn");gotologinbut.classList.add("warn");break;case "accregsuccesful":case "alreadyloggedon":loginregscreen.classList.add("loggedin");
break;default:console.warn("unknown error occured",response)}};xhttp.open("POST","/register/",!0);xhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");xhttp.send("username="+a+"&password="+b)}userfield.onkeypress=function(a){a.target.value.match(/[^\x21-\x7E]/)||a.key.match(/[^\x21-\x7E]/)?a.target.classList.add("error"):a.target.classList.remove("error");"Enter"==a.key&&(a.target.value.match(/[^\x21-\x7E]/)?a.target.classList.add("error"):passfield.focus())};
reguserfield.oninput=function(a){a.target.value?a.target.value.match(/[^\x21-\x7E]/)?(a.target.classList.add("error"),a.target.classList.remove("warn"),a.target.classList.remove("correct")):(a.target.classList.remove("error"),httpusernameexist(a.target.value)):(a.target.classList.remove("warn"),a.target.classList.remove("correct"),a.target.classList.remove("error"))};reguserfield.onkeypress=function(a){"Enter"==a.key&&(a.target.value.match(/[^\x21-\x7E]/)?a.target.classList.add("error"):regpassfield.focus())};
passfield.onkeypress=function(a){a.target.value.match(/[^\x21-\x7E]/)||a.key.match(/[^\x21-\x7E]/)?a.target.classList.add("error"):a.target.classList.remove("error");"Enter"==a.key&&(userfield.value?(a.target.value+userfield.value).match(/[^\x21-\x7E]/)?a.target.classList.add("error"):httplogin(userfield.value,passfield.value):(userfield.classList.add("error"),userfield.focus()))};
regpassfield.onkeypress=function(a){a.target.value.match(/[^\x21-\x7E]/)||a.key.match(/[^\x21-\x7E]/)?a.target.classList.add("error"):a.target.classList.remove("error");"Enter"==a.key&&(userfield.value?(reguserfield.classList.add("error"),reguserfield.focus()):(a.target.value+reguserfield.value).match(/[^\x21-\x7E]/)?a.target.classList.add("error"):valregpassfield.focus())};
valregpassfield.onkeypress=function(a){valregpassfield.value+a.key==regpassfield.value&&valregpassfield.value&&regpassfield.value?(valregpassfield.classList.add("correct"),regpassfield.classList.add("correct")):(valregpassfield.classList.remove("correct"),regpassfield.classList.remove("correct"));"Enter"==a.key&&(reguserfield.value?valregpassfield.value==regpassfield.value?(console.log("initiate httpsignup"),valregpassfield.classList.add("correct"),regpassfield.classList.add("correct"),httpreg(reguserfield.value,
regpassfield.value)):(valregpassfield.classList.add("error"),regpassfield.classList.add("error")):(reguserfield.classList.add("error"),reguserfield.focus()))};passfield.onclick=function(a){userfield.value||(userfield.focus(),userfield.classList.add("error"))};function submitloginform(){httplogin(userfield.value,passfield.value)}function submitregform(){httpreg(reguserfield.value,regpassfield.value)}
function checkHash(){if("#register"==window.location.hash)return loginregscreen.setAttribute("screen","register"),document.title="Registration - Projec.cc","changing to registration";if("#login"==window.location.hash)return loginregscreen.setAttribute("screen","login"),document.title="Welcome to Projec.cc","changing to login"}window.onload=function(){checkHash();updatefeed()};window.onhashchange=function(){checkHash()};
function updatefeed(){feed.classList.add("loading");xhttp=new XMLHttpRequest;xhttp.onreadystatechange=function(){4==this.readyState&&200==this.status&&(response=JSON.parse(this.responseText),console.log(response),response.error?console.error(response.error):setTimeout(function(){feed.innerHTML="";response.forEach(function(a,b){feed.innerHTML+='<div class="postwrapper"><div class="post"><h3>'+a.title+"</h3><p>"+a.content+'</p><div class="userwrapper"><img src="/resources/profilepicture/example.jpg" alt=""><span>'+
a.userid+"</span></div></div></div>"});feed.classList.remove("loading")},250))};xhttp.open("GET","/retrieveposts/",!0);xhttp.send()};
